<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article Preview | Finex</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Source+Sans+Pro:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <link rel="stylesheet" href="build.css">
    <style>
        .preview-container {
            position: relative;
            max-height: 500px; /* Adjust preview length */
            overflow: hidden;
            -webkit-mask-image: linear-gradient(to bottom, black 60%, transparent 100%);
            mask-image: linear-gradient(to bottom, black 60%, transparent 100%);
            margin-bottom: -6rem; /* Pull CTA up */
        }
         .article-preview-content {
             padding-bottom: 8rem; /* Avoid abrupt end */
         }
        .cta-overlay {
            position: relative; z-index: 10; margin-top: 0; padding-top: 2rem;
            /* Match dark body background for gradient */
            background: linear-gradient(to top, #0c111e 30%, transparent 100%);
        }
         /* Simplified article content styles (already in main.css via prose potentially, but added here for specificity) */
         .article-content h2, .article-content h3 { @apply border-t border-color-base pt-6 mt-8 text-2xl font-bold; }
         .article-content p, .article-content li { @apply text-color-muted leading-relaxed mb-4; }
         .article-content a { @apply text-blue-500 hover:underline; }
         .article-content ul { @apply list-disc list-inside space-y-2 mb-4 ml-4; }
         .article-content ol { @apply list-decimal list-inside space-y-2 mb-4 ml-4; }
         .article-content img { @apply rounded-lg my-4 max-w-full h-auto mx-auto shadow-md; }
    </style>
</head>
<body class="antialiased textured-background dark"> <header class="header backdrop-blur-md sticky top-0 z-30">
        <div class="container mx-auto flex justify-between items-center p-4">
             <div class="text-2xl font-bold tracking-wider text-color-base"><a href="index.html">Finex</a></div>
             <nav class="flex items-center gap-4"><a href="login.html" class="main-button text-sm py-2 px-5">Get Full Access</a></nav>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">
        <div class="max-w-4xl mx-auto">
            <a href="guest_dashboard.html" class="text-blue-500 hover:text-blue-400 mb-6 inline-flex items-center group">
                <i class="fas fa-arrow-left mr-2 transform group-hover:-translate-x-1 transition-transform"></i>Back to Guest Dashboard
            </a>

            <div class="glass-card p-6 md:p-10">
                 <h1 id="guest-article-title" class="text-4xl md:text-5xl font-bold leading-tight mb-3">Loading Article Preview...</h1>
                 <div id="guest-article-meta" class="text-sm text-color-muted mb-8">Loading info...</div>

                 <div class="preview-container">
                    <article id="guest-article-content" class="article-content article-preview-content space-y-6">
                        <p class="text-center text-color-muted">Loading content...</p>
                    </article>
                 </div>

                 <div class="cta-overlay flex flex-col items-center justify-center text-center pt-8">
                     <div class="glass-card text-center p-6 md:p-8 w-full max-w-lg shadow-xl">
                         <h2 class="text-xl font-bold mb-3">Unlock The Full Article & More</h2>
                         <p class="text-color-muted mb-6 text-sm">Become a Finex member to access the complete guide, plus exclusive tools, analysis, and our full content library.</p>
                         <div class="flex flex-col sm:flex-row gap-4 justify-center">
                             <a href="login.html" class="main-button font-bold text-base py-2.5 px-6">Sign Up Free</a>
                             <a href="login.html" class="secondary-button font-bold text-base py-2.5 px-6">Member Login</a>
                         </div>
                     </div>
                 </div>
            </div>
        </div>
    </main>

     <footer class="py-8 px-4 border-t border-color-base mt-16">
        <div class="container mx-auto text-center text-color-muted text-sm">
             &copy; 2025 Finex. All Rights Reserved. | <a href="index.html" class="hover:text-blue-500">Home</a>
        </div>
    </footer>

    <script type="module">
        // Import the initialized db from app.js
        import { db } from './app.js';
        
        // Import only the functions we need
        import { collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

        // --- Firebase config and init are no longer needed here ---

        // --- Fetch and Display Latest Article Preview ---
        async function fetchSampleArticle() {
            const titleEl = document.getElementById('guest-article-title');
            const metaEl = document.getElementById('guest-article-meta');
            const contentEl = document.getElementById('guest-article-content');

            if (!titleEl || !metaEl || !contentEl) {
                console.error("Guest article elements not found!"); return;
            }

            try {
                const q = query(collection(db, "articles"), orderBy("createdAt", "desc"), limit(1));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    const doc = querySnapshot.docs[0]; const article = { id: doc.id, ...doc.data() };
                    titleEl.textContent = article.title || "Article Preview";
                    const formattedDate = article.createdAt?.toDate().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) || '';
                    metaEl.innerHTML = `
                        <span>By ${article.author || 'Finex Team'}</span>
                        ${formattedDate ? `<span class="mx-2">&bull;</span><span>${formattedDate}</span>` : ''}
                        ${article.readTime ? `<span class="mx-2">&bull;</span><span>${article.readTime}</span>` : ''}
                    `;
                    // === SECURITY FIX: Sanitize HTML content ===
                    contentEl.innerHTML = article.content ? DOMPurify.sanitize(article.content) : "<p>Could not load content.</p>";
                } else {
                    titleEl.textContent = "No Articles Found"; metaEl.textContent = "";
                    contentEl.innerHTML = "<p class='text-center text-color-muted'>No sample article available.</p>";
                }
            } catch (error) {
                console.error("Error fetching sample article: ", error);
                titleEl.textContent = "Error Loading Preview"; metaEl.textContent = "";
                contentEl.innerHTML = "<p class='text-center text-red-500'>Could not load preview.</p>";
            }
        }
        fetchSampleArticle(); // Fetch on load
    </script>
</body>
</html>
